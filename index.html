<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>調査２ 認知能力テスト</title>
<style>
  body {
    font-family: "Hiragino Sans", "Meiryo", sans-serif;
    background: linear-gradient(180deg, #f2f6fc, #ffffff);
    margin: 0;
    padding: 0;
    text-align: center;
    color: #333;
  }
  .container {
    max-width: 600px;
    margin: 50px auto;
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    padding: 30px;
  }
  h1 {
    color: #2b5fae;
  }
  h2 {
    color: #444;
    border-bottom: 2px solid #ddd;
    padding-bottom: 6px;
  }
  button {
    background-color: #2b5fae;
    color: white;
    border: none;
    padding: 12px 28px;
    border-radius: 10px;
    font-size: 1rem;
    cursor: pointer;
    margin-top: 20px;
  }
  button:disabled {
    background-color: #ccc;
    cursor: not-allowed;
  }
  .word {
    font-size: 2rem;
    margin: 40px 0;
  }
  .input-list input {
    width: 80%;
    padding: 8px;
    margin: 5px;
    border: 1px solid #ccc;
    border-radius: 8px;
    text-align: center;
  }
  .color-word {
    font-size: 2.5rem;
    margin: 30px 0;
    font-weight: bold;
  }
  .color-buttons button {
    background-color: white;
    color: black;
    border: 1px solid #aaa;
    border-radius: 10px;
    padding: 10px 20px;
    margin: 8px;
    cursor: pointer;
    transition: 0.2s;
  }
  .color-buttons button:hover {
    background-color: #e8e8e8;
  }
  ul {
    text-align: left;
    display: inline-block;
    margin-top: 20px;
  }
</style>
</head>
<body>

<div class="container" id="main">

  <h1>調査２ 認知能力テスト</h1>
  <p>次に、認知能力に関するテストを行います。</p>
  <button onclick="startSection1()">スタート</button>

</div>

<script>
const main = document.getElementById("main");

// -------------------- Section 1 --------------------
function startSection1() {
  main.innerHTML = `
    <h2>(1) 単語リスト再生リスト</h2>
    <p>これから、10個の単語が順番に一個づつ表示されます。それらを順番どおりでなくても良いので覚えているものだけ回答してください。メモを取らないようにお願いします。</p>
    <button onclick="startWordList()">スタート</button>
  `;
}

const wordPool = ["太平洋","エンジン","リストラ","テレパシー","天丼","ふんどし","入浴剤","小学校","ホームラン","白旗","南京錠","エゴイスト","スピーチ","血液型","パトカー","アザラシ","書道","代講","改札口","ばんそうこう"];
let wordList = [];
let correctWordList = [];
let userAnswers = [];

function startWordList() {
  // 無作為に10個選ぶ
  wordList = [];
  const shuffled = [...wordPool].sort(()=>Math.random()-0.5);
  wordList = shuffled.slice(0,10);
  correctWordList = [...wordList];
  main.innerHTML = `<div class="word" id="wordDisplay"></div>`;
  let index = 0;

  const showWord = () => {
    if(index < wordList.length){
      document.getElementById("wordDisplay").textContent = wordList[index];
      index++;
      setTimeout(showWord, 2000);
    } else {
      setTimeout(showAnswerInput, 3000);
    }
  };
  showWord();
}

function showAnswerInput() {
  main.innerHTML = `
    <p>単語は以上です。解答は表示されたものと同様に記入してください。</p>
    <div class="input-list">
      ${Array(10).fill(0).map((_,i)=>`<input type="text" id="ans${i}" placeholder="単語${i+1}">`).join("")}
    </div>
    <button onclick="checkWordAnswers()">解答完了</button>
  `;
}

function checkWordAnswers() {
  userAnswers = [];
  for(let i=0;i<10;i++){
    userAnswers.push(document.getElementById(`ans${i}`).value.trim());
  }
  let correctCount = 0;
  userAnswers.forEach(ans=>{
    if(correctWordList.includes(ans)) correctCount++;
  });
  window.wordScore = correctCount / 10 * 100;
  startSection2();
}

// -------------------- Section 2 --------------------
const colorNames = ["赤","青","黄","緑","紫","茶","ピンク"];
const colorValues = {
  "赤":"red", "青":"blue", "黄":"gold", "緑":"green",
  "紫":"purple", "茶":"brown", "ピンク":"pink"
};
let stroopIndex = 0;
let stroopScore = 0;
let stroopErrors = 0;
let stroopTimes = [];
let lastTime = 0;
let lock = false;

function startSection2() {
  main.innerHTML = `
    <h2>(2) ストループ課題</h2>
    <p>画面に色の名前が表示されます。文字の色（表示色）を答えてください。意味（文字の読み）ではなく、表示色を選んでください。なるべく素早く回答してください。しかし、間違えてしまうと二秒間回答できないので注意してください。</p>
    <div class="color-word" style="color:blue;">赤</div>
    <p>上の例題では、答えは「赤」ではなく、表示色の「青」です。</p>
    <button onclick="startStroop()">スタート</button>
  `;
}

function startStroop() {
  stroopIndex = 0;
  stroopScore = 0;
  stroopErrors = 0;
  stroopTimes = [];
  showStroopTrial();
}

function showStroopTrial() {
  if(stroopIndex >= 10) return showResult();

  const text = colorNames[Math.floor(Math.random()*colorNames.length)];
  let color;
  do {
    color = colorNames[Math.floor(Math.random()*colorNames.length)];
  } while(color === text);

  main.innerHTML = `
    <h2>(2) ストループ課題</h2>
    <div class="color-word" id="stroopWord" style="color:${colorValues[color]};">${text}</div>
    <div class="color-buttons">
      ${colorNames.map(c=>`<button onclick="checkStroop('${color}','${c}')">${c}</button>`).join("")}
    </div>
  `;
  lastTime = performance.now();
}

function checkStroop(correctColor, selectedColor) {
  if(lock) return;
  const now = performance.now();
  const rt = (now - lastTime) / 1000;
  if(selectedColor === correctColor){
    stroopScore++;
    stroopTimes.push(rt);
    stroopIndex++;
    showStroopTrial();
  } else {
    stroopErrors++;
    lock = true;
    setTimeout(()=>{lock=false;},2000);
  }
}

function showResult() {
  const avgTime = stroopTimes.reduce((a,b)=>a+b,0)/stroopTimes.length;
  main.innerHTML = `
    <h2>テストは以上です。ありがとうございました。</h2>
    <p>テストは以上です。ありがとうございました。以下が結果です。先ほどのアンケートに戻り、結果を記入してください。結果が記入し終わったら、このサイトは閉じていただいて構いません。</p>
    <ul>
      <li>単語リスト再生テストの正答率：${window.wordScore.toFixed(1)}%</li>
      <li>ストループ課題の誤答回数：${stroopErrors}回</li>
      <li>ストループ課題の平均解答時間：${avgTime.toFixed(2)}秒</li>
    </ul>
  `;
}
</script>

</body>
</html>
