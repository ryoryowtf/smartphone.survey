<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>高校生スマホ利用と認知能力調査</title>
<style>
  body {
    font-family: "Noto Sans JP", sans-serif;
    background: linear-gradient(to right, #eef2f3, #8e9eab);
    margin: 0;
    padding: 20px;
  }
  .container {
    background: white;
    max-width: 700px;
    margin: 0 auto;
    border-radius: 15px;
    padding: 30px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  }
  h1, h2 {
    text-align: center;
    color: #333;
  }
  p {
    line-height: 1.6;
    color: #444;
  }
  input[type="text"], input[type="number"], textarea {
    width: 100%;
    padding: 10px;
    margin: 5px 0 15px;
    border: 1px solid #ccc;
    border-radius: 8px;
    font-size: 16px;
  }
  button {
    background-color: #1976d2;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
  }
  button:hover {
    background-color: #125ca1;
  }
  .hidden { display: none; }
  .color-buttons button {
    background-color: white;
    color: black;
    margin: 5px;
  }
</style>
</head>
<body>
<div class="container">
  <h1>高校生スマホ利用と認知能力調査</h1>
  <div id="intro">
    <p>このアンケートは、高校生のスマホ利用と認知能力の関係に関する調査に使われます。<br>スマホを用意してください。※数分の時間を要します。</p>
    <input id="userName" type="text" placeholder="名前を入力してください" />
    <button onclick="startSurvey()">アンケートを開始</button>
  </div>

  <!-- アンケート -->
  <div id="survey1" class="hidden">
    <h2>調査1：アンケート調査</h2>
    <p>Androidの場合：設定→Digital Wellbeingと保護者による使用時間→円グラフの中央をタップして棒グラフを確認してください。<br>
    iPhoneの場合：設定→スクリーンタイム→すべてのアプリとWebサイトのアクティビティを表示を確認してください。</p>
    <p>(1) スマートフォンを平日にどれだけ利用しますか。</p>
    <input id="q1" type="number" placeholder="()時間" /> 時間
    <p>(2) スマートフォンを休日にどれだけ利用しますか。</p>
    <input id="q2" type="number" placeholder="()時間" /> 時間

    <p>(3) 一番使用時間の長い曜日の棒グラフをクリックしてください。使う時間が多い順にアプリと使用時間を入力してください。</p>
    <div id="q3-area">
      <input class="q3" type="text" placeholder="(アプリ名)を(時間)使用" oninput="addField('q3-area','q3')" />
    </div>

    <p>(4) (3)で入力したアプリのうち、勉強目的で使っている（例：Youtubeで授業の動画を見る）アプリがあれば、アプリ名とその利用時間を教えてください。</p>
    <div id="q4-area">
      <input class="q4" type="text" placeholder="(アプリ名)を(時間)使用" oninput="addField('q4-area','q4')" />
    </div>

    <p>(5) 親や自分自身が、スマホを制限していますか。</p>
    <label><input type="radio" name="q5" value="O" onchange="toggleQ6()"> O </label>
    <label><input type="radio" name="q5" value="X" onchange="toggleQ6()"> X </label>

    <div id="q6-area" class="hidden">
      <p>(6) 制限内容を具体的に教えてください。</p>
      <textarea id="q6" rows="3" placeholder="制限内容を入力"></textarea>
    </div>
    <button onclick="finishSurvey1()">入力完了</button>
  </div>

  <!-- 単語リスト再生 -->
  <div id="memory-test" class="hidden">
    <h2>調査2：認知能力テスト</h2>
    <p>これから、15個の単語が順番に一個づつ表示されます。それらを順番どおりでなくても良いので覚えているものだけ回答してください。メモを取らないようにお願いします。</p>
    <button onclick="startMemory()">スタート</button>
    <div id="wordDisplay" style="font-size:24px; margin-top:20px; text-align:center;"></div>
    <div id="memory-answer" class="hidden">
      <p>単語は以上です。覚えているものを入力してください。</p>
      <div id="memory-fields"></div>
      <button onclick="finishMemory()">解答完了</button>
    </div>
  </div>

  <!-- ストループ課題 -->
  <div id="stroop-test" class="hidden">
    <h2>ストループ課題</h2>
   <p id="stroop-text">画面に色の名前が表示されます。文字の色（表示色）を答えてください。意味（文字の読み）ではなく、表示色を選んでください。<br>
                       なるべく素早く回答してください。しかし、間違えてしまうと二秒間回答できないので注意してください。</p>
    <button id="stroop-start" onclick="startStroop()">スタート</button>
    <div id="stroop-display" style="font-size:32px; text-align:center; margin:20px;"></div>
    <div class="color-buttons hidden" id="color-buttons"></div>
  </div>

  <div id="end-message" class="hidden">
    <h2>テストは以上です。</h2>
    <p>ありがとうございました。このサイトは閉じていただいて構いません。</p>
  </div>
</div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbwmabfd9RBFW7mD_BOPwIr1mHc2B1Bx1MpN4Xr9KJYUQ0viu5hD1Y6wQGQwcFs08pYP/exec";

let data = { name: "", answers: {}, memoryTest: {}, stroopTest: {} };
const wordList = ["犬","机","花","山","水","空","月","本","川","木","車","雨","鳥","石","家"];

function startSurvey(){
  const name = document.getElementById("userName").value.trim();
  if(!name){ alert("名前を入力してください"); return; }
  data.name = name;
  document.getElementById("intro").classList.add("hidden");
  document.getElementById("survey1").classList.remove("hidden");
}

function addField(areaId, cls){
  const area = document.getElementById(areaId);
  const fields = area.querySelectorAll("input");
  const last = fields[fields.length-1];
  if(last.value.trim() !== ""){
    const newField = document.createElement("input");
    newField.type="text"; newField.className=cls;
    newField.placeholder="(アプリ名)を(時間)使用";
    newField.oninput = () => addField(areaId, cls);
    area.appendChild(newField);
  }
}

function toggleQ6(){
  const q5 = document.querySelector('input[name="q5"]:checked');
  if(q5 && q5.value==="O"){
    document.getElementById("q6-area").classList.remove("hidden");
  }else{
    document.getElementById("q6-area").classList.add("hidden");
  }
}

function finishSurvey1(){
  data.answers.q1 = document.getElementById("q1").value;
  data.answers.q2 = document.getElementById("q2").value;
  data.answers.q3 = Array.from(document.querySelectorAll(".q3")).map(i=>i.value).filter(v=>v);
  data.answers.q4 = Array.from(document.querySelectorAll(".q4")).map(i=>i.value).filter(v=>v);
  const q5 = document.querySelector('input[name="q5"]:checked');
  data.answers.q5 = q5 ? q5.value : "";
  data.answers.q6 = document.getElementById("q6").value;
  document.getElementById("survey1").classList.add("hidden");
  document.getElementById("memory-test").classList.remove("hidden");
}

let shownWords=[];
async function startMemory(){
  document.getElementById("wordDisplay").textContent="";
  shownWords = wordList.sort(()=>Math.random()-0.5);
  let i=0;
  const display = document.getElementById("wordDisplay");
  const btns = document.querySelectorAll("#memory-test button");
  btns.forEach(b=>b.classList.add("hidden"));
  const interval = setInterval(()=>{
    if(i<shownWords.length){
      display.textContent = shownWords[i++];
    } else {
      clearInterval(interval);
      setTimeout(()=>{
        display.textContent="";
        document.getElementById("memory-answer").classList.remove("hidden");
        const area = document.getElementById("memory-fields");
        area.innerHTML="";
        for(let j=0;j<15;j++){
          const inp=document.createElement("input");
          inp.type="text"; area.appendChild(inp);
        }
      },3000);
    }
  },2000);
}

function finishMemory(){
  const answers = Array.from(document.querySelectorAll("#memory-fields input")).map(i=>i.value.trim());
  const correct = answers.filter(a=>shownWords.includes(a)).length;
  data.memoryTest.correctRate = Math.round(correct/shownWords.length*100);
  document.getElementById("memory-test").classList.add("hidden");
  document.getElementById("stroop-test").classList.remove("hidden");
}

const colors = ["赤","青","黄","緑","紫","茶","ピンク","オレンジ"];
const colorMap = {
  "赤":"#ff0000","青":"#0000ff","黄":"#ffff00","緑":"#00ff00","紫":"#800080",
  "茶":"#8b4513","ピンク":"#ff69b4","オレンジ":"#ffa500"
};

let stroopIndex=0, stroopStart=0, stroopData=[];
function startStroop(){
  document.getElementById("stroop-start").classList.add("hidden");
  const btnArea=document.getElementById("color-buttons");
  btnArea.classList.remove("hidden");
  btnArea.innerHTML="";
  colors.forEach(c=>{
    const b=document.createElement("button");
    b.textContent=c;
    b.onclick=()=>checkStroop(c);
    btnArea.appendChild(b);
  });
  nextStroop();
}

function nextStroop(){
  if(stroopIndex>=10){
    finishStroop();
    return;
  }
  const word = colors[Math.floor(Math.random()*colors.length)];
  let color;
  do{ color=colors[Math.floor(Math.random()*colors.length)]; }while(color===word);
  const disp=document.getElementById("stroop-display");
  disp.textContent=word;
  disp.style.color=colorMap[color];
  stroopStart=performance.now();
  disp.dataset.correct=color;
}

function checkStroop(ans){
  const disp=document.getElementById("stroop-display");
  const correct=disp.dataset.correct;
  if(ans===correct){
    const time=performance.now()-stroopStart;
    stroopData.push(time);
    stroopIndex++;
    nextStroop();
  }else{
    Array.from(document.querySelectorAll("#color-buttons button")).forEach(b=>b.disabled=true);
    setTimeout(()=>{
      Array.from(document.querySelectorAll("#color-buttons button")).forEach(b=>b.disabled=false);
    },2000);
  }
}

function finishStroop(){
  data.stroopTest.reactionTimes = stroopData;
  sendDataToSheet(data);
  document.getElementById("stroop-test").classList.add("hidden");
  document.getElementById("end-message").classList.remove("hidden");
}

async function sendDataToSheet(data){
  await fetch(scriptURL,{
    method:"POST",
    body:JSON.stringify(data),
    headers:{"Content-Type":"application/json"}
  });
}
</script>
</body>
</html>
